!function(){"use strict";var e=window.wp.data,l=window.wp.blockSerializationDefaultParser;function o(e){return e.map((e=>{let l=e.innerBlocks||[];l.length&&(e.innerBlocks=o(l));let t=e.attrs;t.content||(t={...e.attrs,content:e.innerContent[0]}),console.log("=== checking inner: ",e.blockName);let c=null;if("multiple-blocks-plugin/template-h3-custom-field"==e.blockName)t.field_name=t.field_name,t.tag_type="h3",t.class_name="h3-heading",c=wp.blocks.createBlock("multiple-blocks-plugin/meta-block",t,e.innerBlocks);else if("multiple-blocks-plugin/template-p-custom-field"==e.blockName)t.field_name=t.field_name,t.tag_type="p",c=wp.blocks.createBlock("multiple-blocks-plugin/meta-block",t,e.innerBlocks);else if("multiple-blocks-plugin/template-h1-custom-field"==e.blockName)t.field_name=t.field_name,t.tag_type="h1",t.class_name="h1-heading",c=wp.blocks.createBlock("multiple-blocks-plugin/meta-block",t,e.innerBlocks);else if("core/image"==e.blockName){let l=jQuery(e.innerHTML).find("img").attr("src");t.url=l,c=wp.blocks.createBlock(e.blockName,t,e.innerBlocks)}else if("multiple-blocks-plugin/template-custom-field"==e.blockName){let e=acf.get(t.field_name);e||(e=acf.getFields({name:t.field_name})[0].val()),console.log("getting template-custom-field..",t.field_name),console.log("raw contents: "),console.log(e);let l=wp.blocks.createBlock("core/html",{content:e});console.log("htmlBlock: ",l),c=wp.blocks.createBlock("multiple-blocks-plugin/template-acf-wysiwyg-container",{field_name:t.field_name},[l])}else c=wp.blocks.createBlock(e.blockName,t,e.innerBlocks);return console.log("inner returns insertedBlock: ",c),c}))}function t(){wp.data.dispatch("core/block-editor").removeBlocks(wp.data.select("core/block-editor").getBlocks().map((e=>e.clientId))),(console.log("getTemplate().."),fetch("http://localhost:8888/wp-json/multiple-blocks-plugin/v1/author/1").then((e=>e.json())).then((e=>(console.log("fetched: ",e),e.content))).catch((function(e){throw e}))).then((e=>{function t(e,l){return console.log("processBlock: ",e),"core/html"===e.name?(l.push(e),l):(e.innerBlocks.length>0&&e.innerBlocks.forEach((function(e){console.log("calling recursive.."),t(e,l)})),l)}console.log("got template: ",e),(0,l.parse)(e).forEach((e=>{if(e.blockName){let l=e.blockName;console.log("== checking block: ",e.blockName);let t=o(e.innerBlocks),c=e.attrs;c.content||(c={...e.attrs,content:e.innerContent[0]});let n=null;if("multiple-blocks-plugin/template-h3-custom-field"==e.blockName)c.field_name=c.field_name,n=wp.blocks.createBlock("multiple-blocks-plugin/meta-block",c,t);else if("multiple-blocks-plugin/template-p-custom-field"==e.blockName)c.field_name=c.field_name,c.tag_type="p",n=wp.blocks.createBlock("multiple-blocks-plugin/meta-block",c,t);else if("multiple-blocks-plugin/template-h1-custom-field"==e.blockName)c.field_name=c.field_name,c.tag_type="h1",n=wp.blocks.createBlock("multiple-blocks-plugin/meta-block",c,t);else if("multiple-blocks-plugin/template-custom-field"==e.blockName){let e=acf.get(c.field_name);e||(e=acf.getFields({name:c.field_name})[0].val());let l=wp.blocks.createBlock("core/html",{content:e});n=wp.blocks.createBlock("multiple-blocks-plugin/template-acf-wysiwyg-container",{field_name:c.field_name},[l])}else if("multiple-blocks-plugin/template-conditional-custom-field"==e.blockName)n=wp.blocks.createBlock("multiple-blocks-plugin/template-acf-wysiwyg-container",{field_name:null},t);else if("multiple-blocks-plugin/template-badges-custom-field"==e.blockName){let e=acf.get(c.field_name),l=null;e?l=acf.get(c.field_name+"allValues"):(e=acf.getFields({name:c.field_name})[0].val(),l=acf.getFields({name:c.field_name})[0].$control().find(":checkbox").map((function(){return jQuery(this).val()})).get()),console.log("checkbox val: ",e),c.all_values=l,c.field_value=e,c.field_name=c.field_name,n=wp.blocks.createBlock("multiple-blocks-plugin/template-badges-editor",c,t)}else n=wp.blocks.createBlock(e.blockName,c,t);console.log("actual insert: ",n),"core/html"!=l&&wp.data.dispatch("core/block-editor").insertBlock(n)}})),console.log("CONVERTING HTML BLOCKS to core blocks..");let c=[];wp.data.select("core/editor").getBlocks().forEach((function(e,l){console.log("passing blocksToProcess: ",c),t(e,c)})),console.log("blockstoprocess: ",c),setTimeout((function(){c.forEach((function(e){wp.data.dispatch("core/editor").replaceBlocks(e.clientId,wp.blocks.rawHandler({HTML:wp.blocks.getBlockContent(e)}))})),wp.data.dispatch("core/block-editor").removeBlocks(wp.data.select("core/block-editor").getBlocks().map((e=>e.clientId))[0])}),1e3)}))}console.log("init-cite.js"),console.log("contentInTemplateEditing"),new Promise((l=>{const o=(0,e.subscribe)((()=>{((0,e.select)("core/editor").isCleanNewPost()||(0,e.select)("core/block-editor").getBlockCount()>0)&&(o(),l())}))})).then((()=>{console.log("editor ready"),wp.data.select("core/edit-site")||t()}))}();