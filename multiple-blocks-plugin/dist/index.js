!function(){"use strict";const{addFilter:e}=wp.hooks,l=["core/list"];var t=window.wp.element,o=window.wp.hooks,c=window.wp.compose,n=window.wp.blockEditor,a=window.wp.components;const i=(0,c.createHigherOrderComponent)((e=>l=>{if("core/image"!==l.name)return(0,t.createElement)(e,l);const{attributes:o,setAttributes:c}=l,{templatedURL:i,templatedCustomField:s}=o;return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(e,l),(0,t.createElement)(n.InspectorAdvancedControls,null,(0,t.createElement)(a.TextControl,{label:"Shortcode URL",onChange:e=>c({templatedURL:e}),value:i}),(0,t.createElement)(a.TextControl,{label:"Template custom field URL",onChange:e=>c({templatedCustomField:e}),value:s})))}),"withInspectorControls");var s=window.wp.data,r=window.wp.blockSerializationDefaultParser;function p(e){return e.map((e=>{let l=e.innerBlocks||[];l.length&&(e.innerBlocks=p(l));let t=e.attrs;t.content||(t={...e.attrs,content:e.innerContent[0]}),console.log("=== checking inner: ",e.blockName);let o=null;if("multiple-blocks-plugin/template-h3-custom-field"==e.blockName)t.field_name=t.field_name,t.tag_type="h3",t.class_name="h3-heading",o=wp.blocks.createBlock("multiple-blocks-plugin/meta-block",t,e.innerBlocks);else if("multiple-blocks-plugin/template-p-custom-field"==e.blockName)t.field_name=t.field_name,t.tag_type="p",o=wp.blocks.createBlock("multiple-blocks-plugin/meta-block",t,e.innerBlocks);else if("multiple-blocks-plugin/template-h1-custom-field"==e.blockName)t.field_name=t.field_name,t.tag_type="h1",t.class_name="h1-heading",o=wp.blocks.createBlock("multiple-blocks-plugin/meta-block",t,e.innerBlocks);else if("core/image"==e.blockName){let l=jQuery(e.innerHTML).find("img").attr("src");t.url=l,o=wp.blocks.createBlock(e.blockName,t,e.innerBlocks)}else if("multiple-blocks-plugin/template-custom-field"==e.blockName){let e=acf.get(t.field_name);e||(e=acf.getFields({name:t.field_name})[0].val()),console.log("getting template-custom-field..",t.field_name),console.log("raw contents: "),console.log(e);let l=wp.blocks.createBlock("core/html",{content:e});console.log("htmlBlock: ",l),o=wp.blocks.createBlock("multiple-blocks-plugin/template-acf-wysiwyg-container",{field_name:t.field_name},[l])}else o=wp.blocks.createBlock(e.blockName,t,e.innerBlocks);return console.log("inner returns insertedBlock: ",o),o}))}function m(){wp.data.dispatch("core/block-editor").removeBlocks(wp.data.select("core/block-editor").getBlocks().map((e=>e.clientId))),(console.log("getTemplate().."),fetch("http://localhost:8888/wp-json/multiple-blocks-plugin/v1/author/1").then((e=>e.json())).then((e=>(console.log("fetched: ",e),e.content))).catch((function(e){throw e}))).then((e=>{function l(e,t){return console.log("processBlock: ",e),"core/html"===e.name?(t.push(e),t):(e.innerBlocks.length>0&&e.innerBlocks.forEach((function(e){console.log("calling recursive.."),l(e,t)})),t)}(0,r.parse)(e).forEach((e=>{if(e.blockName){let l=e.blockName;console.log("== checking block: ",e.blockName);let t=p(e.innerBlocks),o=e.attrs;o.content||(o={...e.attrs,content:e.innerContent[0]});let c=null;if("multiple-blocks-plugin/template-h3-custom-field"==e.blockName)o.field_name=o.field_name,c=wp.blocks.createBlock("multiple-blocks-plugin/meta-block",o,t);else if("multiple-blocks-plugin/template-p-custom-field"==e.blockName)o.field_name=o.field_name,o.tag_type="p",c=wp.blocks.createBlock("multiple-blocks-plugin/meta-block",o,t);else if("multiple-blocks-plugin/template-h1-custom-field"==e.blockName)o.field_name=o.field_name,o.tag_type="h1",c=wp.blocks.createBlock("multiple-blocks-plugin/meta-block",o,t);else if("multiple-blocks-plugin/template-custom-field"==e.blockName){let e=acf.get(o.field_name);e||(e=acf.getFields({name:o.field_name})[0].val());let l=wp.blocks.createBlock("core/html",{content:e});c=wp.blocks.createBlock("multiple-blocks-plugin/template-acf-wysiwyg-container",{field_name:o.field_name},[l])}else if("multiple-blocks-plugin/template-conditional-custom-field"==e.blockName)c=wp.blocks.createBlock("multiple-blocks-plugin/template-acf-wysiwyg-container",{field_name:null},t);else if("multiple-blocks-plugin/template-badges-custom-field"==e.blockName){let e=acf.get(o.field_name),l=null;e?l=acf.get(o.field_name+"allValues"):(e=acf.getFields({name:o.field_name})[0].val(),l=acf.getFields({name:o.field_name})[0].$control().find(":checkbox").map((function(){return jQuery(this).val()})).get()),console.log("checkbox val: ",e),o.all_values=l,o.field_value=e,o.field_name=o.field_name,c=wp.blocks.createBlock("multiple-blocks-plugin/template-badges-editor",o,t)}else c=wp.blocks.createBlock(e.blockName,o,t);console.log("actual insert: ",c),"core/html"!=l&&wp.data.dispatch("core/block-editor").insertBlock(c)}})),console.log("CONVERTING HTML BLOCKS to core blocks..");let t=[];wp.data.select("core/editor").getBlocks().forEach((function(e,o){console.log("passing blocksToProcess: ",t),l(e,t)})),console.log("blockstoprocess: ",t),setTimeout((function(){t.forEach((function(e){wp.data.dispatch("core/editor").replaceBlocks(e.clientId,wp.blocks.rawHandler({HTML:wp.blocks.getBlockContent(e)}))})),wp.data.dispatch("core/block-editor").removeBlocks(wp.data.select("core/block-editor").getBlocks().map((e=>e.clientId))[0])}),1e3)}))}e("blocks.registerBlockType","multiple-blocks-plugin/attribute/aria_label",((e,t)=>l.includes(t)?(e.attributes=Object.assign(e.attributes,{ariaLabel:{type:"string",default:""}}),e):e)),e("blocks.getSaveContent.extraProps","multiple-blocks-plugin/applyAriaLabelAttribute",(function(e,t,o){if(!l.includes(t.name))return e;const{ariaLabel:c}=o;return void 0!==c&&""!=c&&Object.assign(e,{"aria-label":c}),e})),wp.domReady((()=>{wp.blocks.registerBlockStyle("core/post-title",{name:"_ h1-heading",label:"Digimod Page Title"})})),function e(l,t,o){null!=document.querySelector(l)?o():setTimeout((()=>e(l,t,o)),t)}(".edit-post-header__settings",100,(function(){const e=window.location.href;var l=new URL(e).searchParams.get("post");jQuery(".edit-post-header__settings").prepend(`<button onclick="window.open('https://digital-gov-frontend-test-c0cce6-test.apps.silver.devops.gov.bc.ca/wordpress-preview/${l}','_blank');" type="button" class="components-button editor-post-switch-to-draft is-tertiary">Preview on digital.gov.bc.ca</button>`)})),(0,o.addFilter)("blocks.registerBlockType","extending-gutenberg/add-attributes",((e,l)=>{if("core/image"!==l)return e;const t={...e.attributes,templatedURL:{type:"string",default:""},templatedCustomField:{type:"string",default:""}};return{...e,attributes:t}})),(0,o.addFilter)("editor.BlockEdit","extending-gutenberg/edit",i),new Promise((e=>{const l=(0,s.subscribe)((()=>{((0,s.select)("core/editor").isCleanNewPost()||(0,s.select)("core/block-editor").getBlockCount()>0)&&(l(),e())}))})).then((()=>{wp.data.select("core/edit-site")||m()}))}();